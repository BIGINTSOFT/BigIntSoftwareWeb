@{
    ViewData["Title"] = "Menü Yönetimi";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0">Menü Yönetimi</h1>
    <button class="btn btn-primary" id="addMenuBtn">
        <i class="bi bi-plus-circle me-2"></i> Yeni Menü
    </button>
</div>

<div class="card shadow-sm mb-4">
    <div class="card-body">
        <table id="menusTable" class="table table-striped table-hover w-100">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Menü Adı</th>
                    <th>İkon</th>
                    <th>Controller/Action</th>
                    <th>Üst Menü</th>
                    <th>Sıra</th>
                    <th>Durum</th>
                    <th>Yetkiler</th>
                    <th>İşlemler</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>

<!-- Create/Edit Menu Modal -->
<div class="modal fade" id="menuModal" tabindex="-1" aria-labelledby="menuModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-slide modal-lg">
        <div class="modal-content modern-modal">
            <div class="modal-header">
                <h5 class="modal-title" id="menuModalLabel">Menü Bilgileri</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="menuForm">
                    <input type="hidden" id="menuId" name="Id" />
                    
                    <!-- Menü Adı -->
                    <div class="mb-3">
                        <label for="menuName" class="form-label">Menü Adı <span class="text-danger">*</span></label>
                        <input type="text" class="form-control form-control-sm" id="menuName" name="Name" required>
                        <div class="invalid-feedback"></div>
                    </div>
                    
                    <!-- Açıklama -->
                    <div class="mb-3">
                        <label for="menuDescription" class="form-label">Açıklama</label>
                        <textarea class="form-control form-control-sm" id="menuDescription" name="Description" rows="2"></textarea>
                        <div class="invalid-feedback"></div>
                    </div>
                    
                    <!-- İkon -->
                    <div class="mb-3">
                        <label for="menuIcon" class="form-label">İkon (Bootstrap Icons)</label>
                        <input type="text" class="form-control form-control-sm" id="menuIcon" name="Icon" placeholder="bi-speedometer2">
                        <div class="invalid-feedback"></div>
                    </div>
                    
                    <!-- Controller -->
                    <div class="mb-3">
                        <label for="menuController" class="form-label">Controller</label>
                        <input type="text" class="form-control form-control-sm" id="menuController" name="Controller">
                        <div class="invalid-feedback"></div>
                    </div>
                    
                    <!-- Action -->
                    <div class="mb-3">
                        <label for="menuAction" class="form-label">Action</label>
                        <input type="text" class="form-control form-control-sm" id="menuAction" name="Action">
                        <div class="invalid-feedback"></div>
                    </div>
                    
                    <!-- Sıra -->
                    <div class="mb-3">
                        <label for="menuSortOrder" class="form-label">Sıra</label>
                        <input type="number" class="form-control form-control-sm" id="menuSortOrder" name="SortOrder" value="0">
                        <div class="invalid-feedback"></div>
                    </div>
                    
                    <!-- Durum -->
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="menuIsActive" name="IsActive" checked>
                            <label class="form-check-label" for="menuIsActive">
                                Aktif Menü
                            </label>
                        </div>
                    </div>
                    
                    <!-- Görünürlük -->
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="menuIsVisible" name="IsVisible" checked>
                            <label class="form-check-label" for="menuIsVisible">
                                Görünür Menü
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelMenuBtn">
                    <i class="bi bi-x-lg me-2"></i>
                    İptal
                </button>
                <button type="button" class="btn btn-primary" id="saveMenuBtn">
                    <i class="bi bi-check-lg me-2"></i>
                    Kaydet
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Menu Permissions Management Modal -->
<div class="modal fade" id="menuPermissionsModal" tabindex="-1" aria-labelledby="menuPermissionsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-slide" style="max-width: 40%; width: 40%;">
        <div class="modal-content modern-modal">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="menuPermissionsModalLabel">
                    <i class="bi bi-list-ul me-2"></i>
                    Menü Yetkileri
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Menü Bilgileri Kartı -->
                <div class="card mb-4 border-0 shadow-sm">
                    <div class="card-body bg-light">
                        <div class="row align-items-center">
                            <div class="col-auto">
                                <div class="avatar-circle bg-info text-white">
                                    <i class="bi bi-list-ul fs-4"></i>
                                </div>
                            </div>
                            <div class="col">
                                <div class="row">
                                    <div class="col-md-4">
                                        <h6 class="mb-1 text-muted">Menü Adı</h6>
                                        <p class="mb-0 fw-bold" id="modalMenuName">-</p>
                                    </div>
                                    <div class="col-md-4">
                                        <h6 class="mb-1 text-muted">Controller/Action</h6>
                                        <p class="mb-0 fw-bold" id="modalMenuControllerAction">-</p>
                                    </div>
                                    <div class="col-md-4">
                                        <h6 class="mb-1 text-muted">Durum</h6>
                                        <span class="badge" id="modalMenuStatus">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bilgilendirme Mesajları -->
                <div id="menuModalAlert" class="alert alert-dismissible fade" role="alert" style="display: none;">
                    <span id="menuModalAlertMessage"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>

                <!-- Tab Navigation -->
                <ul class="nav nav-tabs mb-4" id="permissionTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab">
                            <i class="bi bi-people me-2"></i>Kullanıcı Yetkileri
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="roles-tab" data-bs-toggle="tab" data-bs-target="#roles" type="button" role="tab">
                            <i class="bi bi-shield-check me-2"></i>Rol Yetkileri
                        </button>
                    </li>
                </ul>

                <!-- Tab Content -->
                <div class="tab-content" id="permissionTabContent">
                    <!-- Users Tab -->
                    <div class="tab-pane fade show active" id="users" role="tabpanel">
                        <div class="row">
                            <!-- Mevcut Kullanıcı Yetkileri -->
                            <div class="col-lg-6">
                                <div class="card border-primary">
                                    <div class="card-header bg-primary text-white">
                                        <h6 class="mb-0">
                                            <i class="bi bi-people-fill me-2"></i>
                                            Bu Menüye Yetkili Kullanıcılar
                                        </h6>
                                    </div>
                                    <div class="card-body p-0">
                                        <div style="height: 400px; overflow-y: auto;">
                                            <div id="assignedUsersPermissionsList" class="p-3">
                                                <!-- AJAX ile doldurulacak -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Kullanıcı Yetkisi Ekleme -->
                            <div class="col-lg-6">
                                <div class="card border-success">
                                    <div class="card-header bg-success text-white">
                                        <h6 class="mb-0">
                                            <i class="bi bi-person-plus me-2"></i>
                                            Yeni Kullanıcı Yetkisi Ekle
                                        </h6>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="p-3 border-bottom">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text bg-light">
                                                    <i class="bi bi-search"></i>
                                                </span>
                                                <input type="text" class="form-control form-control-sm" id="userPermissionSearchInput" 
                                                       placeholder="Kullanıcı ara...">
                                            </div>
                                        </div>
                                        <div style="height: 350px; overflow-y: auto;">
                                            <div id="availableUsersPermissionsList" class="p-3">
                                                <!-- AJAX ile doldurulacak -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Roles Tab -->
                    <div class="tab-pane fade" id="roles" role="tabpanel">
                        <div class="row">
                            <!-- Mevcut Rol Yetkileri -->
                            <div class="col-lg-6">
                                <div class="card border-warning">
                                    <div class="card-header bg-warning text-dark">
                                        <h6 class="mb-0">
                                            <i class="bi bi-shield-fill me-2"></i>
                                            Bu Menüye Yetkili Roller
                                        </h6>
                                    </div>
                                    <div class="card-body p-0">
                                        <div style="height: 400px; overflow-y: auto;">
                                            <div id="assignedRolesPermissionsList" class="p-3">
                                                <!-- AJAX ile doldurulacak -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Rol Yetkisi Ekleme -->
                            <div class="col-lg-6">
                                <div class="card border-info">
                                    <div class="card-header bg-info text-white">
                                        <h6 class="mb-0">
                                            <i class="bi bi-shield-plus me-2"></i>
                                            Yeni Rol Yetkisi Ekle
                                        </h6>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="p-3 border-bottom">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text bg-light">
                                                    <i class="bi bi-search"></i>
                                                </span>
                                                <input type="text" class="form-control form-control-sm" id="rolePermissionSearchInput" 
                                                       placeholder="Rol ara...">
                                            </div>
                                        </div>
                                        <div style="height: 350px; overflow-y: auto;">
                                            <div id="availableRolesPermissionsList" class="p-3">
                                                <!-- AJAX ile doldurulacak -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-lg me-2"></i>
                    Kapat
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Menu Management JS -->
    <script src="~/js/menu-management.js"></script>
}
